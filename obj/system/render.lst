ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 ;; INIT OF RENDER.S
                              2 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                              3 .include "./manager/entities.h.s"
                              1 ;; This file contains all the indexes to adress to the entities
                              2 
                              3 .module Entity_Manager
                              4 
                              5 ;;------------------------------------------------------
                              6 ;; Entities
                              7 ;; Definition of entity structure fields
                              8 
                     0000     9 e_cmps      == 0
                     0001    10 e_x         == 1
                     0002    11 e_y         == 2
                     0003    12 e_vx        == 3
                     0004    13 e_vy        == 4
                     0005    14 e_color     == 5
                     0006    15 e_type      == 6
                     0007    16 e_prv_ptr   == 7      ;; Pointer, 2 bytes
                     0009    17 e_width     == 9
                     000A    18 e_height    == 10
                             19 
                             20 ;; Entity info
                     000B    21 sizeof_e        == 11
                     0064    22 max_entities    == 100
                             23 
                             24 
                             25 ;; Bit for matching & properties
                             26 
                     0007    27 e_cmps_alive_bit    = 7
                     0006    28 e_cmps_position_bit = 6
                     0005    29 e_cmps_input_bit    = 5
                     0004    30 e_cmps_physics_bit  = 4
                     0003    31 e_cmps_render_bit   = 3
                             32 
                             33 ;; Component Types (masks)
                     0000    34 e_cmps_invalid  = 0x00
                     0080    35 e_cmps_alive    = (1 << e_cmps_alive_bit)
                     0040    36 e_cmps_position = (1 << e_cmps_position_bit)
                     0020    37 e_cmps_input    = (1 << e_cmps_input_bit)
                     0010    38 e_cmps_physics  = (1 << e_cmps_physics_bit)
                     0008    39 e_cmps_render   = (1 << e_cmps_render_bit)
                     00FF    40 e_cmps_default  = 0xFF
                             41 
                             42 ;; Entity types
                     0000    43 e_type_mainchar     = 0
                     0001    44 e_type_enemy        = 1
                     0002    45 e_type_floor        = 2
                     0003    46 e_type_bullet       = 3
                             47 
                             48 ;; Public functions
                             49 .globl man_entity_init
                             50 .globl man_entity_create
                             51 .globl man_entity_destroy
                             52 .globl man_entity_forall
                             53 .globl man_entity_forall_matching
                             54 .globl man_entity_forall_pairs_matching
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 3.
Hexadecimal [16-Bits]



                             55 .globl man_entity_get_from_idx
                             56 .globl man_entity_set4destruction
                             57 .globl man_entity_update
                             58 .globl cpct_memcpy_asm
                             59 .globl man_entity_increase_num
                             60 .globl man_entity_decrease_num
                             61 .globl mainchar_entity
                             62 .globl increase_free_entity
                             63 .globl man_entity_first_entity
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 4.
Hexadecimal [16-Bits]



                              4 
                              5 .globl cpct_setVideoMode_asm
                              6 .globl man_entity_forall
                              7 .globl cpct_setPalette_asm
                              8 .globl cpct_getScreenPtr_asm
                              9 .globl cpct_drawSolidBox_asm
                             10 
                             11 ;; sys_render_init::   ;; NO FUNCIONA
                             12 ;;     ;; MODE 0
                             13 ;;     ld c, #0
                             14 ;;     call cpct_setVideoMode_asm
                             15 ;; 
                             16 ;;     ;; BORDER, SET_PALETTE
                             17 ;;     cpctm_setBorder_asm HW_WHITE
                             18 ;;     ld hl, #palette
                             19 ;;     ld de, #16
                             20 ;;     call cpct_setPalette_asm
                             21 ;; ret
                             22 
                             23 ;; ---------------------------------------------
                             24 ;; Updates all the entities
                             25 ;; B -> Mask to filter
                             26 ;; ---------------------------------------------
   0000                      27 sys_render_update::
   0000 21 09 00      [10]   28     ld hl, #sys_render_forone
   0003 06 08         [ 7]   29     ld b, #e_cmps_render ;; e_cmps_render
   0005 CD 00 00      [17]   30     call man_entity_forall_matching
   0008 C9            [10]   31 ret
                             32 
                             33 ;; -----------------------------------------
                             34 ;; Renders one entity
                             35 ;; IX -> entity
                             36 ;; -----------------------------------------
   0009                      37 sys_render_forone::
                             38 
   0009 DD 5E 07      [19]   39     ld e, e_prv_ptr+0(ix)
   000C DD 56 08      [19]   40     ld d, e_prv_ptr+1(ix)
   000F AF            [ 4]   41     xor a
   0010 CD 00 00      [17]   42     call cpct_drawSolidBox_asm
                             43 
   0013 11 00 C0      [10]   44     ld de, #0xC000
   0016 DD 4E 01      [19]   45     ld c, e_x(ix)
   0019 DD 46 02      [19]   46     ld b, e_y(ix)
   001C CD 00 00      [17]   47     call cpct_getScreenPtr_asm
   001F EB            [ 4]   48     ex de, hl
                             49 
   0020 DD 73 07      [19]   50     ld e_prv_ptr+0(ix), e
   0023 DD 72 08      [19]   51     ld e_prv_ptr+1(ix), d
                             52 
   0026 DD 7E 05      [19]   53     ld a, e_color(ix)
   0029 01 02 08      [10]   54     ld bc, #0x0802
   002C CD 00 00      [17]   55     call cpct_drawSolidBox_asm
   002F C9            [10]   56 ret
                             57 
   0030                      58 sys_render_wait::
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 5.
Hexadecimal [16-Bits]



   0030 3E 12         [ 7]   59     ld a, #18
   0032                      60     halts:
   0032 76            [ 4]   61         halt
   0033 76            [ 4]   62         halt
   0034 3D            [ 4]   63         dec a
   0035 20 FB         [12]   64         jr nz, halts
   0037 C9            [10]   65 ret
